{"version":3,"file":"esp8266-5b2b537a.js","sources":["../../node_modules/esptool-js/lib/targets/esp8266.js"],"sourcesContent":["import { ROM } from \"./rom\";\nimport ESP8266_STUB from \"./stub_flasher/stub_flasher_8266.json\";\nexport class ESP8266ROM extends ROM {\n    constructor() {\n        super(...arguments);\n        this.CHIP_NAME = \"ESP8266\";\n        this.CHIP_DETECT_MAGIC_VALUE = [0xfff0c101];\n        this.EFUSE_RD_REG_BASE = 0x3ff00050;\n        this.UART_CLKDIV_REG = 0x60000014;\n        this.UART_CLKDIV_MASK = 0xfffff;\n        this.XTAL_CLK_DIVIDER = 2;\n        this.FLASH_WRITE_SIZE = 0x4000;\n        // NOT IMPLEMENTED, SETTING EMPTY VALUE\n        this.BOOTLOADER_FLASH_OFFSET = 0;\n        this.UART_DATE_REG_ADDR = 0;\n        this.FLASH_SIZES = {\n            \"512KB\": 0x00,\n            \"256KB\": 0x10,\n            \"1MB\": 0x20,\n            \"2MB\": 0x30,\n            \"4MB\": 0x40,\n            \"2MB-c1\": 0x50,\n            \"4MB-c1\": 0x60,\n            \"8MB\": 0x80,\n            \"16MB\": 0x90,\n        };\n        this.SPI_REG_BASE = 0x60000200;\n        this.SPI_USR_OFFS = 0x1c;\n        this.SPI_USR1_OFFS = 0x20;\n        this.SPI_USR2_OFFS = 0x24;\n        this.SPI_MOSI_DLEN_OFFS = 0; // not in esp8266\n        this.SPI_MISO_DLEN_OFFS = 0; // not in esp8266\n        this.SPI_W0_OFFS = 0x40;\n        this.TEXT_START = ESP8266_STUB.text_start;\n        this.ENTRY = ESP8266_STUB.entry;\n        this.DATA_START = ESP8266_STUB.data_start;\n        this.ROM_DATA = ESP8266_STUB.data;\n        this.ROM_TEXT = ESP8266_STUB.text;\n        this.get_chip_features = async (loader) => {\n            const features = [\"WiFi\"];\n            if ((await this.get_chip_description(loader)) == \"ESP8285\")\n                features.push(\"Embedded Flash\");\n            return features;\n        };\n    }\n    async read_efuse(loader, offset) {\n        const addr = this.EFUSE_RD_REG_BASE + 4 * offset;\n        loader.debug(\"Read efuse \" + addr);\n        return await loader.read_reg(addr);\n    }\n    async get_chip_description(loader) {\n        const efuse3 = await this.read_efuse(loader, 2);\n        const efuse0 = await this.read_efuse(loader, 0);\n        const is_8285 = ((efuse0 & (1 << 4)) | (efuse3 & (1 << 16))) != 0; // One or the other efuse bit is set for ESP8285\n        return is_8285 ? \"ESP8285\" : \"ESP8266EX\";\n    }\n    async get_crystal_freq(loader) {\n        const uart_div = (await loader.read_reg(this.UART_CLKDIV_REG)) & this.UART_CLKDIV_MASK;\n        const ets_xtal = (loader.transport.baudrate * uart_div) / 1000000 / this.XTAL_CLK_DIVIDER;\n        let norm_xtal;\n        if (ets_xtal > 33) {\n            norm_xtal = 40;\n        }\n        else {\n            norm_xtal = 26;\n        }\n        if (Math.abs(norm_xtal - ets_xtal) > 1) {\n            loader.info(\"WARNING: Detected crystal freq \" +\n                ets_xtal +\n                \"MHz is quite different to normalized freq \" +\n                norm_xtal +\n                \"MHz. Unsupported crystal in use?\");\n        }\n        return norm_xtal;\n    }\n    _d2h(d) {\n        const h = (+d).toString(16);\n        return h.length === 1 ? \"0\" + h : h;\n    }\n    async read_mac(loader) {\n        let mac0 = await this.read_efuse(loader, 0);\n        mac0 = mac0 >>> 0;\n        let mac1 = await this.read_efuse(loader, 1);\n        mac1 = mac1 >>> 0;\n        let mac3 = await this.read_efuse(loader, 3);\n        mac3 = mac3 >>> 0;\n        const mac = new Uint8Array(6);\n        if (mac3 != 0) {\n            mac[0] = (mac3 >> 16) & 0xff;\n            mac[1] = (mac3 >> 8) & 0xff;\n            mac[2] = mac3 & 0xff;\n        }\n        else if (((mac1 >> 16) & 0xff) == 0) {\n            mac[0] = 0x18;\n            mac[1] = 0xfe;\n            mac[2] = 0x34;\n        }\n        else if (((mac1 >> 16) & 0xff) == 1) {\n            mac[0] = 0xac;\n            mac[1] = 0xd0;\n            mac[2] = 0x74;\n        }\n        else {\n            loader.error(\"Unknown OUI\");\n        }\n        mac[3] = (mac1 >> 8) & 0xff;\n        mac[4] = mac1 & 0xff;\n        mac[5] = (mac0 >> 24) & 0xff;\n        return (this._d2h(mac[0]) +\n            \":\" +\n            this._d2h(mac[1]) +\n            \":\" +\n            this._d2h(mac[2]) +\n            \":\" +\n            this._d2h(mac[3]) +\n            \":\" +\n            this._d2h(mac[4]) +\n            \":\" +\n            this._d2h(mac[5]));\n    }\n    get_erase_size(offset, size) {\n        return size;\n    }\n}\n"],"names":["ESP8266ROM","ROM","ESP8266_STUB","loader","features","offset","addr","efuse3","uart_div","ets_xtal","norm_xtal","d","h","mac0","mac1","mac3","mac","size"],"mappings":"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","x_google_ignoreList":[0]}